<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>手机扫码页面</title>
<script src="https://unpkg.com/jsqr/dist/jsQR.js"></script>
<style>
  body {
    font-family: Arial, sans-serif;
    text-align: center;
    padding: 20px;
  }
  video {
    width: 100%;
    max-width: 400px;
    border: 1px solid #ccc;
  }
  #result {
    margin-top: 20px;
    font-size: 18px;
    color: green;
    word-break: break-all;
  }
  button {
    margin-top: 20px;
    padding: 10px 20px;
    font-size: 16px;
  }
</style>
</head>
<body>

<h1>手机扫码页面</h1>
<video id="video" autoplay playsinline></video>
<canvas id="canvas" style="display:none;"></canvas>
<div id="result">请扫描二维码</div>
<button id="startBtn">开始扫描</button>
<button id="stopBtn">停止扫描</button>

<script>
const video = document.getElementById('video');
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const resultDiv = document.getElementById('result');
let scanning = false;
let stream;

async function startScan() {
    try {
        stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } });
        video.srcObject = stream;
        scanning = true;
        resultDiv.textContent = "请对准二维码进行扫描";
        scanFrame();
    } catch (err) {
        console.error("无法访问摄像头:", err);
        resultDiv.textContent = "无法访问摄像头";
    }
}

function stopScan() {
    scanning = false;
    if(stream) {
        stream.getTracks().forEach(track => track.stop());
        resultDiv.textContent = "扫描已停止";
    }
}

function scanFrame() {
    if(!scanning) return;
    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;
    ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
    const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
    const code = jsQR(imageData.data, imageData.width, imageData.height);
    if(code) {
        resultDiv.textContent = `扫描结果: ${code.data}`;
        console.log("扫描内容:", code.data);
    }
    requestAnimationFrame(scanFrame);
}

document.getElementById('startBtn').addEventListener('click', startScan);
document.getElementById('stopBtn').addEventListener('click', stopScan);
</script>

</body>
</html>
